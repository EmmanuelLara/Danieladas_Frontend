<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pedidos - Danieladas</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" />
  <style>
    body {
      background-image: url("img/fondo.png");
      background-size: cover;
      background-attachment: fixed;
      font-family: "Poppins", sans-serif;
    }

    .card {
      border-radius: 15px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      margin-bottom: 20px;
      background-color: #fff8f0;
    }

    .pedido-header {
      background-color: #ffe3f3;
      border-radius: 15px 15px 0 0;
      padding: 10px;
      font-weight: 600;
      color: #e22b5a;
    }

    .pedido-body {
      padding: 15px;
    }

    .btn-entregar {
      background-color: #ff9fd6;
      border: none;
      border-radius: 20px;
      padding: 6px 12px;
      color: white;
      font-weight: bold;
    }

    .btn-entregar:hover {
      background-color: #ff7fbd;
    }
  </style>
</head>
<body class="container py-4">

  <h2 class="text-center text-danger mb-4"><i class="bi bi-receipt"></i> Pedidos Recibidos</h2>

  <div id="listaPedidos">
    <!-- Pedidos generados dinÃ¡micamente -->
  </div>

  <div class="text-center mt-3">
    <button class="btn btn-secondary" onclick="window.location.href='cuenta.html'">
      <i class="bi bi-arrow-left"></i> Regresar
    </button>
  </div>

  <script>
    // ðŸ”¹ Cargar pedidos desde localStorage (si no hay, crear algunos de ejemplo)
    const pedidos = JSON.parse(localStorage.getItem("pedidos")) || [
      {
        id: 1,
        cliente: "Mane Lara",
        productos: [
          { tipo: "Vaso", tamano: "Mediano", sabores: ["Fresa", "Chocolate"], precio: 30 },
          { tipo: "Nachos", ingredientes: ["Queso", "Chiles"], precio: 45 }
        ],
        total: 75,
        estado: "Pendiente"
      },
      {
        id: 2,
        cliente: "Andrea Ruiz",
        productos: [
          { tipo: "Cono", tamano: "Grande", sabores: ["Vainilla", "Mango", "Nuez"], precio: 40 }
        ],
        total: 40,
        estado: "Pendiente"
      }
    ];

    const lista = document.getElementById("listaPedidos");

    pedidos.forEach((pedido, index) => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="pedido-header">
          Pedido #${pedido.id} - Cliente: ${pedido.cliente}
        </div>
        <div class="pedido-body">
          ${pedido.productos.map(p => `
            <div>
              <strong>${p.tipo}</strong> - ${p.tamano || ""}
              ${p.sabores ? `<br>Sabor(es): ${p.sabores.join(", ")}` : ""}
              ${p.ingredientes ? `<br>Ingredientes: ${p.ingredientes.join(", ")}` : ""}
              <p><strong>Precio:</strong> $${p.precio}</p>
              <hr>
            </div>
          `).join("")}
          <p class="fw-bold">Total: $${pedido.total}</p>
          <p><strong>Estado:</strong> <span id="estado-${index}" class="text-warning">${pedido.estado}</span></p>
          <button class="btn-entregar" onclick="marcarEntregado(${index})">Marcar como entregado</button>
        </div>
      `;
      lista.appendChild(card);
    });

    function marcarEntregado(index) {
      // ðŸ”¸ Cambiar estado localmente en la lista del vendedor
      pedidos[index].estado = "Entregado âœ…";
      localStorage.setItem("pedidos", JSON.stringify(pedidos));

      // ðŸ”¸ Mostrar cambio visual inmediato
      const estadoEl = document.getElementById(`estado-${index}`);
      estadoEl.textContent = "Entregado âœ…";
      estadoEl.classList.replace("text-warning", "text-success");

      // ðŸ”¸ Actualizar tambiÃ©n en "misPedidos" del cliente
      let misPedidos = JSON.parse(localStorage.getItem("misPedidos")) || [];
      misPedidos = misPedidos.map(p => {
        if (p.id === pedidos[index].id) {
          p.estado = "Entregado âœ…";
        }
        return p;
      });
      localStorage.setItem("misPedidos", JSON.stringify(misPedidos));

      // ðŸ”¸ ConfirmaciÃ³n visual
      alert(`âœ… Pedido #${pedidos[index].id} marcado como ENTREGADO y sincronizado con el cliente.`);
    }
  </script>
</body>
</html>
